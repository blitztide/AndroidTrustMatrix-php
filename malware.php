<?php
define('matrix',true);
include_once "drawpage.php";
include('config.php');

$content = '
<h2>Identified Applications</h2>
<ul>';

if(!isset($_GET['page'])){
	$page_number = 1;
} else {
	$page_number = $_GET['page'];
}

$base = ($page_number - 1) * $limit;
$ceil = $page_number * $limit;

$sql = 'Select Marketplace.name,Applications.PackageName,Applications.Version,Applications.SHA256Sum FROM Availability INNER JOIN Marketplace ON Availability.MarketID=Marketplace.MarketID INNER JOIN Applications ON Availability.ApplicationID=Applications.ApplicationID WHERE Applications.isMalware = True LIMIT ' . $base . ','. $ceil . ';';

$result = $conn->query($sql);

$content .= '<div class="expanding">';
if ($result->num_rows > 0)
{
	$content .= '<li><table class="list"><tr><th>Marketplace</th><th>Application Name</th><th>Version</th><th>SHA256</th></tr>';
	while ($row = $result->fetch_assoc())
	{
		$content .= '<tr><td>'. $row['name'] . '</td><td>' . $row['PackageName'] . '</td><td>'. $row['Version'].'</td><td>' . $row['SHA256Sum'] . '</td></tr>';
	}

} else {
	$content .= '<li> NO APPLICATIONS FOUND </li>';
}
$content .= '</div>';
$conn -> close();
$content .= '</table></ul>';
$content .= '</li><li><a href="/malware.php?page=' . ($page_number - 1) . '">Previous page</a><a href="/malware.php?page=' . ($page_number + 1 ) .'">Next page</a></li>';
drawpage($content);
?>
